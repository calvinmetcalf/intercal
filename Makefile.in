#
# Productions for the INTERCAL distribution
#
VERSION=@PACKAGE_VERSION@

# Common prefix for machine-independent installed files.
prefix = @prefix@
# Common prefix for machine-dependent installed files.
exec_prefix = @exec_prefix@

# Directory in which to install binaries.
bindir = @bindir@
# Directory in which to install libraries.
libdir = @libdir@
# Directory to install data files.
datadir = @datadir@/intercal-@PACKAGE_VERSION@
# Directory to install the include files in.
incdir = @includedir@/intercal-@PACKAGE_VERSION@

# Program to install binaries
INSTALL_PROGRAM = @INSTALL_PROGRAM@
# Program to install the man page.
INSTALL_DATA = @INSTALL_DATA@
# Generic install program.
INSTALL = @INSTALL@

# This can be overridden from the command line
DESTDIR=

# Location of GNU GPL. This will be automatically copied if not required during install.
# If not using install, change this to any copy of the GNU GPL that exists on your system.
# This is required because the yuk debugger reads commands interactively, and so must be
# able to display a copy of the GPL on demand. This is only possible if yuk can find a copy.
# If you want to delete or move the distribution files, then you will have to move COPYING
# to another directory; otherwise, you can aim this at COPYING.
# It's also possible to aim this at a copy of COPYING from another GPL program.
copyloc = ${DESTDIR}${datadir}/COPYING

CC = @CC@
CFLAGS = @CFLAGS@ -DICKINCLUDEDIR=\"$(incdir)\" -DICKLIBDIR=\"$(datadir)\" -DICKBINDIR=\"$(bindir)\" -DYYDEBUG -DYUKCOPYLOC=\"$(copyloc)\"
LDFLAGS = @LDFLAGS@
LEX = @LEX@
LEXFLAGS=
YACC = @YACC@
YACCFLAGS = -d # -t

LOADLIBS = @LIBS@ @INTLLIBS@ @LEXLIB@

CSOURCES = ick.y lexer.l feh.c lose.c fiddle.c perpetrate.c unravel.c
ISOURCES = cesspool.c arrgghh.c ick-wrap.c numerals.c
YSOURCES = yuk.c
HEADERS = ick.h lose.h sizes.h abcess.h fiddle.h feh.h yuk.h
BUILD = Makefile.in Makefile configure.ac configure config.h.in intercal.spec.in intercal.spec install.sh
MISC = intercal.el coopt.sh
DOCS = BUGS COPYING NEWS README
SOURCES = $(CSOURCES) $(ISOURCES) $(YSOURCES) $(HEADERS) $(BUILD) $(MISC) $(DOCS) pit doc

all: ick libick.a libickmt.a libyuk.a

copycopy: COPYING
	-mkdir $(DESTDIR)$(datadir)
	-if cp $(copyloc) /dev/null ; then : ; else cp COPYING $(copyloc) ; fi

checkcopy:
	@echo If the following line fails, change \"copyloc\" in your makefile.
	cp $(copyloc) /dev/null

ick: ick.o lexer.o feh.o lose.o fiddle.o perpetrate.o
	$(CC) perpetrate.o ick.o lexer.o feh.o lose.o fiddle.o $(LDFLAGS) -o ick

y.tab.h ick.c: ick.y ick.h sizes.h feh.h lose.h
	$(YACC) -d $(YACCFLAGS) ick.y
	mv y.tab.c ick.c

lexer.c: lexer.l ick.h lose.h
	$(LEX) $(LEXFLAGS) lexer.l
	mv lex.yy.c lexer.c 

# Uncomment the following if using a stock lex
# LEXLIBS = -ll
lextest: y.tab.h lexer.c ick.h lose.o
	$(CC) -DMAIN lexer.c lose.o $(LEXLIBS) -o lextest

ick.o: ick.c ick.h feh.h lose.h sizes.h
lexer.o: lexer.c y.tab.h ick.h lose.h
feh.o: feh.c feh.h y.tab.h ick.h fiddle.h lose.h sizes.h
perpetrate.o: perpetrate.c y.tab.h ick.h lose.h sizes.h
cesspool.o: cesspool.c numerals.c abcess.h lose.h sizes.h
unravel.o: unravel.c abcess.h lose.h sizes.h
lose.o: lose.h
fiddle.o: fiddle.h sizes.h
yuk.o: checkcopy yuk.h lose.h sizes.h abcess.h

libick.a: cesspool.o lose.o fiddle.o arrgghh.o
	ar cr libick.a cesspool.o lose.o fiddle.o arrgghh.o
	-ranlib libick.a

libickmt.a: cesspool.o unravel.o lose.o fiddle.o arrgghh.o
	ar cr libickmt.a cesspool.o unravel.o lose.o fiddle.o arrgghh.o
	-ranlib libickmt.a

libyuk.a: yuk.o
	ar cr libyuk.a yuk.o
	-ranlib libyuk.a

install: copycopy all
	cp ick $(DESTDIR)$(bindir)
	cp libick.a $(DESTDIR)$(libdir)
	cp libickmt.a $(DESTDIR)$(libdir)
	cp libyuk.a $(DESTDIR)$(libdir)
	-mkdir -p $(DESTDIR)$(incdir)
	cp lose.h abcess.h fiddle.h yuk.h $(DESTDIR)$(incdir)
	-mkdir $(DESTDIR)$(datadir)
	(cp -r pit $(DESTDIR)$(datadir))
	cp ick-wrap.c $(DESTDIR)$(datadir)
	cp coopt.sh $(DESTDIR)$(bindir)

uninstall:
	rm -f $(DESTDIR)$(bindir)/ick $(DESTDIR)$(libdir)/libick.a
	rm -f $(DESTDIR)$(bindir)/coopt.sh
	rm -f $(DESTDIR)$(libdir)/libickmt.a $(DESTDIR)$(libdir)/libyuk.a
	rm -fr $(DESTDIR)$(incdir) $(DESTDIR)$(datadir)

TAGS: $(SOURCES)
	etags $(SOURCES)

dist: intercal-@PACKAGE_VERSION@.tar.gz

intercal-@PACKAGE_VERSION@.tar.gz: $(SOURCES)
	@find $(SOURCES) -type f -print | grep -v RCS | sed s:^:intercal-@PACKAGE_VERSION@/: >MANIFEST
	@(cd ..; ln -s intercal intercal-@PACKAGE_VERSION@)
	(cd ..; tar -czvf intercal/intercal-@PACKAGE_VERSION@.tar.gz `cat intercal/MANIFEST`)
	@(cd ..; rm intercal-@PACKAGE_VERSION@)

clean:
	rm -f yacc.* y.tab.* y.output *~ *.[oa] lexer.c ick.c lextest ick
	rm -f intercal-@PACKAGE_VERSION@.tar.gz intercal.spec core

