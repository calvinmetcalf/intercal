#
# Productions for the INTERCAL distribution
#
VERSION=@PACKAGE_VERSION@

# Common prefix for machine-independent installed files.
prefix = @prefix@
# Common prefix for machine-dependent installed files.
exec_prefix = @exec_prefix@

# Directory in which to install binaries.
bindir = @bindir@
# Directory in which to install libraries.
libdir = @libdir@
# Directory to install data files.
datadir = @datadir@/ick-@PACKAGE_VERSION@
# Directory to install the include files in.
incdir = @includedir@/ick-@PACKAGE_VERSION@
# Directory to install Info files in.
infodir = @infodir@

# This can be overridden from the command line
DESTDIR=

CC = @CC@
CFLAGS = @CFLAGS@ -DICKINCLUDEDIR=\"$(incdir)\" -DICKLIBDIR=\"$(datadir)\" -DICKBINDIR=\"$(bindir)\" -DYYDEBUG -O2 -W -Wall -I./src -I./temp
LDFLAGS = @LDFLAGS@
LEX = @LEX@
LEXFLAGS=
YACC = @YACC@
YACCFLAGS = 

LOADLIBS = @LIBS@ @LEXLIB@

CSOURCES = src/parser.y src/lexer.l src/feh2.c src/dekludge.c src/lose.c src/fiddle.c src/perpet.c src/unravel.c src/uncommon.c
ISOURCES = src/cesspool.c src/arrgghh.c src/ick-wrap.c src/numerals.c
YSOURCES = src/yuk.c
HEADERS = src/ick.h src/lose.h src/sizes.h src/abcess.h src/fiddle.h src/feh.h src/yuk.h src/uncommon.h
BUILD = Makefile.in config.in config.sh src/configh.in ickspec.in ickspec src/cooptsh.in
MISC = etc/intercal.el src/ctrlmfix.sh src/ctrlmfix.bat
DOCS = BUGS.txt COPYING.txt NEWS.txt README.txt
SOURCES = $(CSOURCES) $(ISOURCES) $(YSOURCES) $(HEADERS) $(BUILD) $(MISC) $(DOCS) pit doc

all: bin/ick@EXEEXT@ lib/libick.a lib/libickmt.a lib/libyuk.a ial

ial: src/fiddle.h src/abcess.h src/lose.h src/yuk.h src/ick-wrap.c src/pickwrap.c temp/coopt.sh pit/lib/syslib.i COPYING.txt
	-cp src/fiddle.h include/fiddle.h
	-cp src/abcess.h include/abcess.h
	-cp src/lose.h include/lose.h
	-cp src/yuk.h include/yuk.h
	-cp pit/lib/syslib.i pit/lib/syslib.?i include
	-cp src/ick-wrap.c lib/ick-wrap.c
	-cp src/pickwrap.c lib/pickwrap.c
	-cp temp/coopt.sh lib/coopt.sh
	-cp COPYING.txt lib/COPYING.txt

bin/ick@EXEEXT@: temp/parser.@OBJEXT@ temp/lexer.@OBJEXT@ temp/feh2.@OBJEXT@ temp/dekludge.@OBJEXT@ temp/idiotism.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/perpet.@OBJEXT@ temp/uncommon.@OBJEXT@
	$(CC) temp/perpet.@OBJEXT@ temp/parser.@OBJEXT@ temp/lexer.@OBJEXT@ temp/feh2.@OBJEXT@ temp/dekludge.@OBJEXT@ temp/idiotism.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/uncommon.@OBJEXT@ $(LDFLAGS) -o bin/ick@EXEEXT@

temp/oil.c: src/oil.y temp/config.h
	$(YACC) $(YACCFLAGS) src/oil.y
	-rm -f temp/oil.c
	mv y.tab.c temp/oil.c

temp/parser.h temp/parser.c: src/parser.y src/ick.h src/sizes.h src/feh.h src/lose.h temp/config.h
	$(YACC) -d $(YACCFLAGS) src/parser.y
	-rm -f temp/parser.c
	mv y.tab.c temp/parser.c
	-rm -f temp/parser.h
	mv y.tab.h temp/parser.h

temp/lexer.c: src/lexer.l src/ick.h src/lose.h temp/config.h
	$(LEX) $(LEXFLAGS) src/lexer.l
	-rm -f temp/lexer.c
	mv @LEX_OUTPUT_ROOT@.c temp/lexer.c 

bin/lextest: temp/parser.h src/lexer.c src/ick.h temp/lose.@OBJEXT@
	$(CC) -DMAIN src/lexer.c src/lose.@OBJEXT@ @LEXLIB@ -o bin/lextest

temp/oil@EXEEXT@: temp/oil.c temp/config.h
	$(CC) $(CFLAGS) -o temp/oil@EXEEXT@ temp/oil.c
temp/parser.@OBJEXT@: temp/parser.c src/ick.h src/feh.h src/lose.h src/sizes.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/parser.@OBJEXT@ temp/parser.c
temp/lexer.@OBJEXT@: temp/lexer.c temp/parser.h src/ick.h src/lose.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/lexer.@OBJEXT@ temp/lexer.c
temp/feh2.@OBJEXT@: src/feh2.c src/feh.h temp/parser.h src/ick.h src/fiddle.h src/lose.h src/sizes.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/feh2.@OBJEXT@ src/feh2.c
temp/idiotism.c: src/idiotism.oil temp/oil@EXEEXT@
	temp/oil@EXEEXT@ < src/idiotism.oil > temp/idiotism.c
temp/idiotism.@OBJEXT@: temp/idiotism.c src/feh.h temp/parser.h src/ick.h src/fiddle.h src/lose.h src/sizes.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/idiotism.@OBJEXT@ temp/idiotism.c
temp/dekludge.@OBJEXT@: src/dekludge.c src/feh.h temp/parser.h src/ick.h src/fiddle.h src/lose.h src/sizes.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/dekludge.@OBJEXT@ src/dekludge.c
temp/perpet.@OBJEXT@: src/perpet.c temp/parser.h src/ick.h src/lose.h src/sizes.h src/uncommon.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/perpet.@OBJEXT@ src/perpet.c
temp/cesspool.@OBJEXT@: src/cesspool.c src/abcess.h src/lose.h src/sizes.h
	$(CC) $(CFLAGS) -c -o temp/cesspool.@OBJEXT@ src/cesspool.c
temp/numerals.@OBJEXT@: src/numerals.c src/abcess.h src/lose.h src/sizes.h
	$(CC) $(CFLAGS) -c -o temp/numerals.@OBJEXT@ src/numerals.c
temp/unravel.@OBJEXT@: src/unravel.c src/abcess.h src/lose.h src/sizes.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/unravel.@OBJEXT@ src/unravel.c
temp/lose.@OBJEXT@: src/lose.c src/lose.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/lose.@OBJEXT@ src/lose.c
temp/fiddle.@OBJEXT@: src/fiddle.c src/fiddle.h src/sizes.h
	$(CC) $(CFLAGS) -c -o temp/fiddle.@OBJEXT@ src/fiddle.c
temp/arrgghh.@OBJEXT@: src/arrgghh.c
	$(CC) $(CFLAGS) -c -o temp/arrgghh.@OBJEXT@ src/arrgghh.c
temp/uncommon.@OBJEXT@: src/uncommon.c src/uncommon.h
	$(CC) $(CFLAGS) -c -o temp/uncommon.@OBJEXT@ src/uncommon.c
temp/yuk.@OBJEXT@: src/yuk.c src/yuk.h src/lose.h src/sizes.h src/abcess.h src/uncommon.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/yuk.@OBJEXT@ src/yuk.c

lib/libick.a: temp/cesspool.@OBJEXT@ temp/numerals.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/arrgghh.@OBJEXT@
	ar cr lib/libick.a temp/cesspool.@OBJEXT@ temp/numerals.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/arrgghh.@OBJEXT@
	@RANLIB@ lib/libick.a

lib/libickmt.a: temp/cesspool.@OBJEXT@ temp/numerals.@OBJEXT@ temp/unravel.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/arrgghh.@OBJEXT@
	ar cr lib/libickmt.a temp/cesspool.@OBJEXT@ temp/numerals.@OBJEXT@ temp/unravel.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/arrgghh.@OBJEXT@
	@RANLIB@ lib/libickmt.a

lib/libyuk.a: temp/yuk.@OBJEXT@ temp/uncommon.@OBJEXT@
	ar cr lib/libyuk.a temp/yuk.@OBJEXT@ temp/uncommon.@OBJEXT@
	@RANLIB@ lib/libyuk.a

install: all
	cp bin/ick@EXEEXT@ $(DESTDIR)$(bindir)
	cp lib/libick.a $(DESTDIR)$(libdir)
	cp lib/libickmt.a $(DESTDIR)$(libdir)
	cp lib/libyuk.a $(DESTDIR)$(libdir)
	-mkdir -p $(DESTDIR)$(incdir)
	cp src/lose.h src/abcess.h src/fiddle.h src/yuk.h $(DESTDIR)$(incdir)
	-mkdir $(DESTDIR)$(datadir)
	cp src/ick-wrap.c $(DESTDIR)$(datadir)
	cp include/syslib.i include/syslib.?i $(DESTDIR)$(datadir)
	cp temp/coopt.sh $(DESTDIR)$(libdir)
	cp COPYING.txt $(DESTDIR)$(libdir)
	rm -f $(DESTDIR)$(infodir)/ick.info
	cp doc/ick.inf $(DESTDIR)$(infodir)
	-mv $(DESTDIR)$(infodir)/ick.inf $(DESTDIR)$(infodir)/ick.info
# Note that it's necessary to copy the info file to .inf on an 8.3 system
# and .info otherwise; this is done by copying it to .inf, and then renaming
# to .info; on an 8.3 system, this leaves the extension as .inf because mv
# will signal an (unimportant) error.

uninstall:
	rm -f $(DESTDIR)$(bindir)/ick@EXEEXT@ $(DESTDIR)$(libdir)/libick.a
	rm -f $(DESTDIR)$(libdir)/coopt.sh $(DESTDIR)$(libdir)/COPYING.txt
	rm -f $(DESTDIR)$(libdir)/libickmt.a $(DESTDIR)$(libdir)/libyuk.a
	rm -f ${DESTDIR}${infodir}/ick.inf $(DESTDIR)$(infodir)/ick.info
	rm -fr $(DESTDIR)$(incdir) $(DESTDIR)$(datadir)

TAGS: $(SOURCES)
	etags $(SOURCES)

dist: ick-@PACKAGE_VERSION@.tgz

ick-@PACKAGE_VERSION@.tgz: $(SOURCES)
	@find $(SOURCES) -type f -print | grep -v RCS | sed s:^:ick-@PACKAGE_VERSION@/: >MANIFEST.txt
	@(cd ..; ln -s intercal ick-@PACKAGE_VERSION@)
	(cd ..; tar -czvf intercal/ick-@PACKAGE_VERSION@.tgz `cat intercal/MANIFEST.txt`)
	@(cd ..; rm ick-@PACKAGE_VERSION@)

clean:
	-cp temp/config.h .
	-rm -f temp/* bin/* lib/* include/*
	mv config.h temp

distr:
	-rm -f temp/*.@OBJEXT@ temp/parser.h temp/oil@EXEEXT@ temp/idiotism.c
	-rm -f bin/* lib/* include/*

distclean: distr
	-rm -f config.status config.cache config.log Makefile
	-rm -f temp/config.h temp/coopt.sh
