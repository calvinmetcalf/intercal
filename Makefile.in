#
# Productions for the INTERCAL distribution
#
VERSION=@PACKAGE_VERSION@

# Common prefix for machine-independent installed files.
prefix = @prefix@
# Common prefix for machine-dependent installed files.
exec_prefix = @exec_prefix@

# Debian doesn't like versioned subdirs; give them a way to unversion
# the subdir.

ick_specific_subdir = ick-@PACKAGE_VERSION@

# Modern versions of autoconf use an overridable datarootdir, and this
# doesn't do any harm with older versions.
datarootdir = @datarootdir@
# Directory in which to install binaries.
bindir = @bindir@
# Directory in which to install libraries.
libdir = @libdir@
# Directory to install data files.
datadir = @datadir@/$(ick_specific_subdir)
# Directory to install the include files in.
incdir = @includedir@/$(ick_specific_subdir)
# Directory to install Info files in.
infodir = @infodir@
# Directory to install manpages in.
mandir = @mandir@
# Directory file for Info installation.
infodirfile = @INFODIRFILE@

# This can be overridden from the command line
DESTDIR=

CC = @CC@
CFLAGS = @CFLAGS@ -DICKINCLUDEDIR=\"$(incdir)\" -DICKDATADIR=\"$(datadir)\" -DICKBINDIR=\"$(bindir)\" -DICKLIBDIR=\"$(libdir)\" -DYYDEBUG -O2 -W -Wall -I./src -I./temp
LDFLAGS = @LDFLAGS@
LEX = @LEX@
LEXFLAGS=
YACC = @YACC@
YACCFLAGS =

LOADLIBS = @LIBS@ @LEXLIB@

CSOURCES = src/parser.y src/lexer.l src/feh2.c src/dekludge.c src/lose.c src/fiddle.c src/perpet.c src/unravel.c src/uncommon.c src/convickt.c src/clc-cset.c src/bin2c.c
ISOURCES = src/cesspool.c src/arrgghh.c src/ick-wrap.c src/pickwrap.c src/numerals.c
YSOURCES = src/yuk.c
HEADERS = src/ick.h src/lose.h src/sizes.h src/abcess.h src/fiddle.h src/feh.h src/yuk.h src/uncommon.h
BUILD = Makefile.in config.in config.sh src/configh.in ickspec.in ickspec src/cooptsh.in
MISC = etc/intercal.el src/ctrlmfix.sh src/ctrlmfix.bat src/*.bin
DOCS = BUGS.txt COPYING.txt NEWS.txt README.txt
SOURCES = $(CSOURCES) $(ISOURCES) $(YSOURCES) $(HEADERS) $(BUILD) $(MISC) $(DOCS) pit doc

all: bin/ick@EXEEXT@ bin/convickt@EXEEXT@ lib/libick.a lib/libickmt.a lib/libyuk.a ial

ial: include/fiddle.h include/abcess.h include/lose.h include/yuk.h include/syslib.i include/syslib.3i include/syslib.4i include/syslib.5i include/syslib.6i include/syslib.7i lib/ick-wrap.c lib/pickwrap.c lib/coopt.sh lib/COPYING.txt include/atari.bin include/baudot.bin include/ebcdic.bin include/latin1.bin

include/fiddle.h: src/fiddle.h
	-cp src/fiddle.h include/fiddle.h

include/abcess.h:src/abcess.h
	-cp src/abcess.h include/abcess.h

include/lose.h:src/lose.h
	-cp src/lose.h include/lose.h

include/yuk.h:src/yuk.h
	-cp src/yuk.h include/yuk.h

include/syslib.i: pit/lib/syslib.i
	-cp pit/lib/syslib.i include/syslib.i
include/syslib.3i: pit/lib/syslib.3i
	-cp pit/lib/syslib.3i include/syslib.3i
include/syslib.4i: pit/lib/syslib.4i
	-cp pit/lib/syslib.4i include/syslib.4i
include/syslib.5i: pit/lib/syslib.5i
	-cp pit/lib/syslib.5i include/syslib.5i
include/syslib.6i: pit/lib/syslib.6i
	-cp pit/lib/syslib.6i include/syslib.6i
include/syslib.7i: pit/lib/syslib.7i
	-cp pit/lib/syslib.7i include/syslib.7i

lib/ick-wrap.c:src/ick-wrap.c
	-cp src/ick-wrap.c lib/ick-wrap.c

lib/pickwrap.c:src/pickwrap.c
	-cp src/pickwrap.c lib/pickwrap.c

lib/coopt.sh:temp/coopt.sh
	-cp temp/coopt.sh lib/coopt.sh

lib/COPYING.txt:COPYING.txt
	-cp COPYING.txt lib/COPYING.txt

include/atari.bin:src/atari.bin
	-cp src/atari.bin include/atari.bin
include/baudot.bin:src/baudot.bin
	-cp src/baudot.bin include/baudot.bin
include/ebcdic.bin:src/ebcdic.bin
	-cp src/ebcdic.bin include/ebcdic.bin
include/latin1.bin:src/latin1.bin
	-cp src/latin1.bin include/latin1.bin

bin/ick@EXEEXT@: temp/parser.@OBJEXT@ temp/lexer.@OBJEXT@ temp/feh2.@OBJEXT@ temp/dekludge.@OBJEXT@ temp/idiotism.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/perpet.@OBJEXT@ temp/uncommon.@OBJEXT@
	$(CC) temp/perpet.@OBJEXT@ temp/parser.@OBJEXT@ temp/lexer.@OBJEXT@ temp/feh2.@OBJEXT@ temp/dekludge.@OBJEXT@ temp/idiotism.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/uncommon.@OBJEXT@ $(LDFLAGS) -o bin/ick@EXEEXT@

bin/convickt@EXEEXT@: temp/convickt.@OBJEXT@ temp/clc-cset.@OBJEXT@ temp/uncommon.@OBJEXT@
	$(CC) temp/convickt.@OBJEXT@ temp/clc-cset.@OBJEXT@ temp/uncommon.@OBJEXT@ $(LDFLAGS) -o bin/convickt@EXEEXT@

temp/oil.c: src/oil.y temp/config.h
	$(YACC) $(YACCFLAGS) src/oil.y
	-rm -f temp/oil.c
	mv y.tab.c temp/oil.c

temp/parser.h temp/parser.c: src/parser.y src/ick.h src/sizes.h src/feh.h src/lose.h temp/config.h
	$(YACC) -d $(YACCFLAGS) src/parser.y
	-rm -f temp/parser.c
	mv y.tab.c temp/parser.c
	-rm -f temp/parser.h
	mv y.tab.h temp/parser.h

temp/lexer.c: src/lexer.l src/ick.h src/lose.h temp/config.h
	$(LEX) $(LEXFLAGS) src/lexer.l
	-rm -f temp/lexer.c
	mv @LEX_OUTPUT_ROOT@.c temp/lexer.c

bin/lextest: temp/parser.h src/lexer.c src/ick.h temp/lose.@OBJEXT@
	$(CC) -DMAIN src/lexer.c src/lose.@OBJEXT@ @LEXLIB@ -o bin/lextest

temp/oil@EXEEXT@: temp/oil.c temp/config.h
	$(CC) $(CFLAGS) -o temp/oil@EXEEXT@ temp/oil.c
temp/bin2c@EXEEXT@: src/bin2c.c
	$(CC) $(CFLAGS) -o temp/bin2c@EXEEXT@ src/bin2c.c
temp/parser.@OBJEXT@: temp/parser.c src/ick.h src/feh.h src/lose.h src/sizes.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/parser.@OBJEXT@ temp/parser.c
temp/lexer.@OBJEXT@: temp/lexer.c temp/parser.h src/ick.h src/lose.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/lexer.@OBJEXT@ temp/lexer.c
temp/feh2.@OBJEXT@: src/feh2.c src/feh.h temp/parser.h src/ick.h src/fiddle.h src/lose.h src/sizes.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/feh2.@OBJEXT@ src/feh2.c
temp/idiotism.c: src/idiotism.oil temp/oil@EXEEXT@
	temp/oil@EXEEXT@ < src/idiotism.oil > temp/idiotism.c
temp/idiotism.@OBJEXT@: temp/idiotism.c src/feh.h temp/parser.h src/ick.h src/fiddle.h src/lose.h src/sizes.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/idiotism.@OBJEXT@ temp/idiotism.c
temp/dekludge.@OBJEXT@: src/dekludge.c src/feh.h temp/parser.h src/ick.h src/fiddle.h src/lose.h src/sizes.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/dekludge.@OBJEXT@ src/dekludge.c
temp/perpet.@OBJEXT@: src/perpet.c temp/parser.h src/ick.h src/lose.h src/sizes.h src/uncommon.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/perpet.@OBJEXT@ src/perpet.c
temp/cesspool.@OBJEXT@: src/cesspool.c src/abcess.h src/lose.h src/sizes.h
	$(CC) $(CFLAGS) -c -o temp/cesspool.@OBJEXT@ src/cesspool.c
temp/numerals.@OBJEXT@: src/numerals.c src/abcess.h src/lose.h src/sizes.h
	$(CC) $(CFLAGS) -c -o temp/numerals.@OBJEXT@ src/numerals.c
temp/unravel.@OBJEXT@: src/unravel.c src/abcess.h src/lose.h src/sizes.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/unravel.@OBJEXT@ src/unravel.c
temp/lose.@OBJEXT@: src/lose.c src/lose.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/lose.@OBJEXT@ src/lose.c
temp/fiddle.@OBJEXT@: src/fiddle.c src/fiddle.h src/sizes.h
	$(CC) $(CFLAGS) -c -o temp/fiddle.@OBJEXT@ src/fiddle.c
temp/arrgghh.@OBJEXT@: src/arrgghh.c
	$(CC) $(CFLAGS) -c -o temp/arrgghh.@OBJEXT@ src/arrgghh.c
temp/uncommon.@OBJEXT@: src/uncommon.c src/uncommon.h
	$(CC) $(CFLAGS) -c -o temp/uncommon.@OBJEXT@ src/uncommon.c
temp/yuk.@OBJEXT@: src/yuk.c src/yuk.h src/lose.h src/sizes.h src/abcess.h src/uncommon.h temp/config.h
	$(CC) $(CFLAGS) -c -o temp/yuk.@OBJEXT@ src/yuk.c
temp/clc-cset.@OBJEXT@: src/clc-cset.c src/uncommon.h
	$(CC) $(CFLAGS) -c -o temp/clc-cset.@OBJEXT@ src/clc-cset.c
temp/convickt.@OBJEXT@: src/convickt.c
	$(CC) $(CFLAGS) -c -o temp/convickt.@OBJEXT@ src/convickt.c

temp/cset-a.c: temp/bin2c@EXEEXT@ src/atari.bin
	temp/bin2c@EXEEXT@ clc_cset_atari < src/atari.bin > temp/cset-a.c
temp/cset-b.c: temp/bin2c@EXEEXT@ src/baudot.bin
	temp/bin2c@EXEEXT@ clc_cset_baudot < src/baudot.bin > temp/cset-b.c
temp/cset-e.c: temp/bin2c@EXEEXT@ src/ebcdic.bin
	temp/bin2c@EXEEXT@ clc_cset_ebcdic < src/ebcdic.bin > temp/cset-e.c
temp/cset-l.c: temp/bin2c@EXEEXT@ src/latin1.bin
	temp/bin2c@EXEEXT@ clc_cset_latin1 < src/latin1.bin > temp/cset-l.c
temp/cset-a.@OBJEXT@: temp/cset-a.c
	$(CC) $(CFLAGS) -c -o temp/cset-a.@OBJEXT@ temp/cset-a.c
temp/cset-b.@OBJEXT@: temp/cset-b.c
	$(CC) $(CFLAGS) -c -o temp/cset-b.@OBJEXT@ temp/cset-b.c
temp/cset-e.@OBJEXT@: temp/cset-e.c
	$(CC) $(CFLAGS) -c -o temp/cset-e.@OBJEXT@ temp/cset-e.c
temp/cset-l.@OBJEXT@: temp/cset-l.c
	$(CC) $(CFLAGS) -c -o temp/cset-l.@OBJEXT@ temp/cset-l.c

lib/libick.a: temp/cesspool.@OBJEXT@ temp/numerals.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/arrgghh.@OBJEXT@ temp/clc-cset.@OBJEXT@ temp/cset-a.@OBJEXT@ temp/cset-b.@OBJEXT@ temp/cset-e.@OBJEXT@ temp/cset-l.@OBJEXT@ temp/uncommon.@OBJEXT@
	ar cr lib/libick.a temp/cesspool.@OBJEXT@ temp/numerals.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/arrgghh.@OBJEXT@ temp/clc-cset.@OBJEXT@ temp/cset-a.@OBJEXT@ temp/cset-b.@OBJEXT@ temp/cset-e.@OBJEXT@ temp/cset-l.@OBJEXT@ temp/uncommon.@OBJEXT@
	@RANLIB@ lib/libick.a

lib/libickmt.a: temp/cesspool.@OBJEXT@ temp/numerals.@OBJEXT@ temp/unravel.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/arrgghh.@OBJEXT@ temp/clc-cset.@OBJEXT@ temp/cset-a.@OBJEXT@ temp/cset-b.@OBJEXT@ temp/cset-e.@OBJEXT@ temp/cset-l.@OBJEXT@ temp/uncommon.@OBJEXT@
	ar cr lib/libickmt.a temp/cesspool.@OBJEXT@ temp/numerals.@OBJEXT@ temp/unravel.@OBJEXT@ temp/lose.@OBJEXT@ temp/fiddle.@OBJEXT@ temp/arrgghh.@OBJEXT@ temp/clc-cset.@OBJEXT@ temp/cset-a.@OBJEXT@ temp/cset-b.@OBJEXT@ temp/cset-e.@OBJEXT@ temp/cset-l.@OBJEXT@ temp/uncommon.@OBJEXT@
	@RANLIB@ lib/libickmt.a

lib/libyuk.a: temp/yuk.@OBJEXT@
	ar cr lib/libyuk.a temp/yuk.@OBJEXT@
	@RANLIB@ lib/libyuk.a

install-common: all
	cp bin/ick@EXEEXT@ bin/convickt@EXEEXT@ $(DESTDIR)$(bindir)
	cp lib/libick.a $(DESTDIR)$(libdir)
	cp lib/libickmt.a $(DESTDIR)$(libdir)
	cp lib/libyuk.a $(DESTDIR)$(libdir)
	-mkdir -p $(DESTDIR)$(incdir)
	cp src/lose.h src/abcess.h src/fiddle.h src/yuk.h $(DESTDIR)$(incdir)
	-mkdir -p $(DESTDIR)$(datadir)
	cp include/*.bin $(DESTDIR)$(datadir)
	cp src/ick-wrap.c src/pickwrap.c $(DESTDIR)$(datadir)
	cp include/syslib.i include/syslib.?i $(DESTDIR)$(datadir)
	cp temp/coopt.sh $(DESTDIR)$(datadir)
	cp COPYING.txt $(DESTDIR)$(datadir)
	-mkdir -p $(DESTDIR)$(mandir)/man1
	cp doc/ick.1 doc/convickt.1 $(DESTDIR)$(mandir)/man1
	-mkdir -p $(DESTDIR)$(infodir)
	rm -f $(DESTDIR)$(infodir)/ick.info
	cp doc/ick.in* $(DESTDIR)$(infodir)
	mv $(DESTDIR)$(infodir)/ick.inf $(DESTDIR)$(infodir)/ick.info
# Note that it's necessary to copy the info file to .inf on an 8.3 system
# and .info otherwise; this is done by copying it to .inf, and then renaming
# to .info; on an 8.3 system, this leaves the extension as .inf because mv
# will signal an (unimportant) error. Also, the info directory has to
# be created first if it doesn't exist because /usr/local/share/info
# (the default) doesn't exist by default in Debian.

# install, and gzip the docs after installing.
# The pattern i*[fo] matches ick.info only when uncompressed, even on
# an 8.3 system.
install: install-common
	-gzip -9 -f $(DESTDIR)$(infodir)/ick.in*
	-gzip -9 -f $(DESTDIR)$(mandir)/man1/ick.1
	-gzip -9 -f $(DESTDIR)$(mandir)/man1/convickt.1
	sh -c "@MANDB@ -q"
	sh -c "(test -f $(DESTDIR)$(infodir)/ick.info.gz && @INSTALLINFO@ --quiet --dir-file=$(infodirfile) $(DESTDIR)$(infodir)/ick.info.gz) || true"
	sh -c "(test -f $(DESTDIR)$(infodir)/ick.igz && @INSTALLINFO@ --quiet --dir-file=$(infodirfile) $(DESTDIR)$(infodir)/ick.igz) || true"

# install without gzipping the docs
install-nozip: install-common
	sh -c "@MANDB@ -q"
	sh -c "(test -f $(DESTDIR)$(infodir)/ick.info && @INSTALLINFO@ --quiet --dir-file=$(infodirfile) $(DESTDIR)$(infodir)/ick.info) || true"
	sh -c "(test -f $(DESTDIR)$(infodir)/ick.inf && @INSTALLINFO@ --quiet --dir-file=$(infodirfile) $(DESTDIR)$(infodir)/ick.inf) || true"


uninstall:
	sh -c "@INSTALLINFO@ --quiet --remove --dir-file=$(infodirfile) ick"
	rm -f $(DESTDIR)$(bindir)/ick@EXEEXT@ $(DESTDIR)$(libdir)/libick.a
	rm -f $(DESTDIR)$(bindir)/convickt@EXEEXT@
	rm -f $(DESTDIR)$(libdir)/libickmt.a $(DESTDIR)$(libdir)/libyuk.a
	rm -f ${DESTDIR}${infodir}/ick.i*
	rm -f $(DESTDIR)$(mandir)/man1/ick.1*
	rm -f $(DESTDIR)$(mandir)/man1/convickt.1*
	rm -fr $(DESTDIR)$(incdir) $(DESTDIR)$(datadir)
	sh -c "@MANDB@ -q"

TAGS: $(SOURCES)
	etags $(SOURCES)

dist: ick-@PACKAGE_VERSION@.tgz

ick-@PACKAGE_VERSION@.tgz: $(SOURCES)
	@find $(SOURCES) -type f -print | grep -v RCS | sed s:^:ick-@PACKAGE_VERSION@/: >MANIFEST.txt
	@(cd ..; ln -s intercal ick-@PACKAGE_VERSION@)
	(cd ..; tar -czvf intercal/ick-@PACKAGE_VERSION@.tgz `cat intercal/MANIFEST.txt`)
	@(cd ..; rm ick-@PACKAGE_VERSION@)

clean:
	-cp temp/config.h temp/coopt.sh .
	-rm -f temp/* bin/* lib/* include/*
	mv config.h coopt.sh temp

distr:
	-rm -f temp/*.@OBJEXT@ temp/parser.h temp/oil@EXEEXT@
	-rm -f temp/idiotism.c temp/bin2c@EXEEXT@ temp/cset-?.c
	-rm -f bin/* lib/* include/*

distclean: distr
	-rm -f config.status config.cache config.log Makefile
	-rm -f temp/config.h temp/coopt.sh
